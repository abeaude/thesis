\begin{tikzpicture}

    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=orange!70] (n1) at (0,0) {1};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=blue!80] (n2) at (1,0) {2};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=violet!70] (n3) at (1.5,0.75) {3};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=teal!70] (n4) at (1.1,-0.9) {4};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=magenta!70] (n5) at (0.5,0.75) {5};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=blue!50] (n6) at (-0.3,-0.75) {6};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=red!80] (n7) at (-1.2,-0.75) {7};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=cyan!70] (n8) at (-0.75,0.75) {8};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=purple!80] (n9) at (-1.8,1) {9};
    \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=yellow!70] (n10) at (-1.5,0.2) {10};
    \node (glab) [inner sep=1pt, font=\mathversion{smaller}] at (-2.1,0.2) {\(\symcal{G}\)};

    \draw[thick] (n1) -- (n2);
    \draw[thick] (n3) -- (n2);
    \draw[thick] (n4) -- (n2);
    \draw[thick] (n1) -- (n5);
    \draw[thick] (n1) -- (n6);
    \draw[thick] (n7) -- (n6);
    \draw[thick] (n1) -- (n8);
    \draw[thick] (n9) -- (n8);
    \draw[thick] (n10) -- (n8);

    \draw[-stealth, very thick] (1.3,0) -- (2.4,0);
    \draw[-stealth, very thick] (1.8,-2.2) -- (2.4,-2.2);
    \begin{scope}[yshift=-3.6cm, xshift=-1.5cm]
        \fill[orange!70, inner sep=0pt] (0,1.8) rectangle (3,2);
        \fill[blue!80, inner sep=0pt] (0,1.6) rectangle (3,1.8);
        \fill[violet!70, inner sep=0pt] (0,1.4) rectangle (3,1.6);
        \fill[teal!70, inner sep=0pt] (0,1.2) rectangle (3,1.4);
        \fill[magenta!70, inner sep=0pt] (0,1) rectangle (3,1.2);
        \fill[blue!50, inner sep=0pt] (0,0.8) rectangle (3,1);
        \fill[red!80, inner sep=0pt] (0,0.6) rectangle (3,0.8);
        \fill[cyan!70, inner sep=0pt] (0,0.4) rectangle (3,0.6);
        \fill[purple!80, inner sep=0pt] (0,0.2) rectangle (3,0.4);
        \fill[yellow!70, inner sep=0pt] (0,0) rectangle (3,0.2);
        \draw[step=2mm, black] (0,0) grid (3,2);
        \draw[black,thick] (0,0) rectangle (3,2);
        \draw[stealth-stealth] ([xshift=3pt]3,0) -- node [midway, anchor=west, font=\mathversion{middlesize}, inner sep=1pt] {\(\left|\symcal{V}\right|\)} ([xshift=3pt]3,2);
        \draw[stealth-stealth] ([yshift=3pt]0,2) -- node [midway, anchor=south, font=\mathversion{middlesize}, inner sep=1pt] {\(d_{v}\)} ([yshift=3pt]3,2);
        \coordinate (xpos) at (0,1);
        \node[font=\mathversion{middlesize}, anchor=center, inner sep=2pt] at (glab.south |- xpos.west) {\(X\)};


    \end{scope}

    \draw[black,thick, rounded corners=5, fill=pink!60] (2.5,-3) rectangle (3,1);
    \node (GCN1) [rotate=90,font=\mathversion{smaller}] at (2.75,-1) {\(\operatorname{GCN}\)};
    \node (relu1) [right=5mm of GCN1.south, anchor=north, draw, rounded corners=5,font=\mathversion{smaller}, rotate=90, thick, fill=red!70] {\(\operatorname{ReLU}\)};
    \draw[black,thick, rounded corners=5, fill=pink!60] (4.7,-3) rectangle (5.2,1);
    \node (GCN2) [rotate=90,font=\mathversion{smaller}] at (4.95,-1) {\(\operatorname{GCN}\)};
    \node (relu_last) [right=5mm of GCN2.south, anchor=north, draw, rounded corners=5,font=\mathversion{smaller}, rotate=90, thick, fill=red!70] {\(\operatorname{ReLU}\)};
    \node (readout) [right=5mm of relu_last.south, anchor=north, draw, rounded corners=5,font=\footnotesize, rotate=90, thick, fill=purple!40] {Readout};
    \node (fcn) [right=5mm of readout.south, anchor=north, draw, rounded corners=5,font=\mathversion{smaller}, rotate=90, thick, fill=cyan!50] {\(\operatorname{FCN}\)};
    \node (preds) [right=5mm of fcn.south, anchor=west, draw, rounded corners=5,font=\mathversion{smaller}, thick] {\(\hat{y}\)};

    \draw[-stealth, thick] (GCN1.south) -- (relu1.north);
    \draw[-stealth, thick] (relu1.south) -- (GCN2.north);
    \draw[-stealth, thick] (GCN2.south) -- (relu_last.north);
    \draw[-stealth, thick] (relu_last.south) -- (readout.north);
    \draw[-stealth, thick] (readout.south) -- (fcn.north);
    \draw[-stealth, thick] (fcn.south) -- (preds.west);

    %\node[fit={(GCN1)(preds)}, draw, ultra thick, rounded corners, inner ysep=1.5cm] (gnn) {};

    \begin{scope}[yshift=-5cm, xshift=0cm]
        \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=orange!70] (n1) at (0,0) {1};
        \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=blue!80] (n2) at (1,0) {2};
        \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=violet!70] (n3) at (1.5,0.75) {3};
        \node[draw, circle, thick, inner sep=1pt, font=\scriptsize, minimum size=1.2em, fill=teal!70] (n4) at (1.1,-0.9) {4};
        \draw[thick] (n1) -- (n2);
        \draw[thick] (n3) -- (n2);
        \draw[thick] (n4) -- (n2);
        \node (eq) [font=\mathversion{smaller}, anchor=west] at (2.3,0) {\(\textcolor{blue!80}{h_{2}} = \textcolor{red!70}{f}\left(\cfrac{\textcolor{blue!80}{h_{2}}W}{3} + \cfrac{\left(\textcolor{violet!70}{h_{3}} + \textcolor{teal!70}{h_{4}}\right)W}{\sqrt{3}}+ \cfrac{\textcolor{orange!70}{h_{1}}W}{\sqrt{12}}\right)\)};
        \node[fit={(n1)(n4)(eq)(n3)}, draw, ultra thick, rounded corners] (gconvdetails) {};
        \node (gcnlabel) [draw, very thick, rounded corners, anchor=center, inner sep=3pt, fill=white, font=\footnotesize] at (gconvdetails.north) {Graph convolution on node 2};

    \end{scope}
    \draw[dashed, thick] (4.7,-3) -- (gcnlabel.north west);
    \draw[dashed, thick] (5.2,-3) -- (gcnlabel.north east);
\end{tikzpicture}