name: Compile Thesis manuscript
on:
  push:
    branches:
      - writing
    paths:
      - "**.tex"
      - "**.cls"
      - "**.bib"
      - "**.pdf"
      - "**.csv"
permissions:
  contents: write
jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v4
      - run: git branch
      - run: git --no-pager log -1 --date=short --decorate=short --pretty=format:"shash={%h}, lhash={%H}, authname={%an}, authemail={%ae}, authsdate={%ad}, authidate={%ai}, authudate={%at}, commname={%an}, commemail={%ae}, commsdate={%ad}, commidate={%ai}, commudate={%at}, refnames={%d}" HEAD
      - name: Setup Perl
        uses: shogo82148/actions-setup-perl@v1
        with:
          perl-version: "5.38.2"
      - run: perl perl/gitinfo2.pm 
      - name: Compile full document
        uses: xu-cheng/latex-action@v3
        with:
          root_file: |
            ${{ github.workspace }}/main.tex
            ./chapters/1-Introduction.tex
            ./chapters/2-Background.tex
            ./chapters/3-SOTA.tex
            ./chapters/4-AttOmics.tex
            ./chapters/5-CrossAttOmics.tex
            ./chapters/6-CrossAttOmicsGate.tex
            ./chapters/7-Interpretability.tex
            ./chapters/8-Conclusions.tex
          latexmk_use_xelatex: true
          work_in_root_file_dir: false
          args: -outdir=${{ github.workspace }}/PDF/ -interaction=nonstopmode -file-line-error -halt-on-error
          docker_image: ghcr.io/xu-cheng/texlive-full:20240605
          pre_compile: mkdir -p PDF/chapters PDF/appendix PDF/frontmatter PDF/preamble
      - name: Release PDF files
        uses: softprops/action-gh-release@v2
        with:
          files: |
            ${{ github.workspace }}/PDF/main.pdf
            ${{ github.workspace }}/PDF/1-Introduction.pdf
            ${{ github.workspace }}/PDF/2-Background.pdf
            ${{ github.workspace }}/PDF/3-SOTA.pdf
            ${{ github.workspace }}/PDF/4-AttOmics.pdf
            ${{ github.workspace }}/PDF/5-CrossAttOmics.pdf
            ${{ github.workspace }}/PDF/6-CrossAttOmicsGate.pdf
            ${{ github.workspace }}/PDF/7-Interpretability.pdf
            ${{ github.workspace }}/PDF/8-Conclusions.pdf
          draft: true
          name: Compiled PDFs
